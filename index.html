<!--
    THIS EXAMPLE WAS DOWNLOADED FROM https://echarts.apache.org/examples/zh/editor.html?c=candlestick-sh-2015
-->
<!DOCTYPE html>
<html style="height: 100%">
  <head>
    <meta charset="utf-8" />
  </head>
  <body style="height: 100%; margin: 0">
    <div class="form-group">
      <input
        type="file"
        id="files"
        class="form-control"
        accept=".csv"
        required
      />
    </div>
    <div id="container" style="height: 95%"></div>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"
    ></script>
    <!-- Uncomment this line if you want to dataTool extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
        -->
    <!-- Uncomment this line if you want to use gl extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
        -->
    <!-- Uncomment this line if you want to echarts-stat extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
        -->
    <!-- Uncomment this line if you want to use map
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/map/js/china.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/map/js/world.js"></script>
        -->
    <!-- Uncomment these two lines if you want to use bmap extension
        <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=<Your Key Here>"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
        -->

    <script src="js/papaparse.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/option.js"></script>
    <script type="text/javascript">
      var dom = document.getElementById("container");
      var myChart = echarts.init(dom);
      var app = {};

      var kdates = [];
      var kdata = [];
      function generateData(results) {
        var data = results.data;

        for (i = 0; i < data.length; i++) {
          var row = data[i];
          kdates.push(
            moment(row.time, "YYYYMMDDhhmm").format("YYYY/MM/DD HH:mm")
          );
          kdata.push([
            parseFloat(row.open),
            parseFloat(row.close),
            parseFloat(row.low),
            parseFloat(row.high),
          ]);
        }

        var option = getOption(kdates, kdata);
        if (option && typeof option === "object") {
          myChart.setOption(option);
        }
      }

      var fileInput = document.getElementById("files");
      readFile = function () {
        console.log("readfile");
        var result = Papa.parse(fileInput.files[0], {
          complete: generateData,
          header: true,
        });
      };

      fileInput.addEventListener("change", readFile);
    </script>
  </body>
</html>
